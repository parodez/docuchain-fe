<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Upload</title>
    <style>
      body { font-family: Arial; padding: 16px; }
      .card { max-width: 420px; margin: 0 auto; border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
      button { width: 100%; height: 44px; border: 0; border-radius: 10px; background: #2f9f63; color: white; font-weight: 700; }
      input { width: 100%; margin: 10px 0; }
      img { width: 100%; margin-top: 12px; border-radius: 10px; display: none; }
    </style>
  </head>
  <body>
    <div class="card">
      <h3>Upload from Phone</h3>
      <p>Select or capture an image, then upload.</p>

      <input id="file" type="file" accept="image/*" capture="environment" />
      <button id="btn">Upload</button>

      <img id="preview" />
      <p id="msg"></p>
    </div>

    <script>
      const params = new URLSearchParams(location.search);
      const sessionId = params.get("sessionId");
      const input = document.getElementById("file");
      const btn = document.getElementById("btn");
      const msg = document.getElementById("msg");
      const preview = document.getElementById("preview");

      input.addEventListener("change", () => {
        const file = input.files[0];
        if (file) {
          preview.src = URL.createObjectURL(file);
          preview.style.display = "block";
        }
      });

      btn.addEventListener("click", async () => {
        const file = input.files[0];
        if (!sessionId) return (msg.textContent = "Missing sessionId.");
        if (!file) return (msg.textContent = "Choose or capture an image first.");

        const form = new FormData();
        form.append("sessionId", sessionId);
        form.append("file", file);

        msg.textContent = "Uploading...";

        const res = await fetch("http://192.168.1.17:5000/api/upload", {
          method: "POST",
          body: form,
        });

        const data = await res.json();
        msg.textContent = data.ok ? "Uploaded! You can go back to the computer." : "Upload failed.";
      });
    </script>
  </body>
</html>
